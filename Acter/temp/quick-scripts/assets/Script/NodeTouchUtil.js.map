{"version":3,"sources":["NodeTouchUtil.js"],"names":["touchMoveScaleX","speed","maxMoveY","NodeTouchUtil","New","node","inst","img","touchNode","cc","Node","setContentSize","director","getWinSize","width","parent","localPos","getPosition","localRotate","getRotation","initTouchFunction","prototype","on","EventType","TOUCH_START","event","hasChoose","p","touch","_point","_lastTouchPoint","_rotation","TOUCH_MOVE","p1","p2","dx","x","dy","y","Math","abs","console","log","setPosition","runAction","moveTo","easing","easeSineIn","direction","stopAllActions","posX","getContentSize","setRotation","touchend","dt","easeIn","rotateTo","TOUCH_END","TOUCH_CANCEL","module","exports"],"mappings":"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","file":"NodeTouchUtil.js","sourceRoot":"../../../../assets/Script","sourcesContent":["/**\n * 节点触摸移动的方法\n */\n\n// 横向移动的缩放值\nvar touchMoveScaleX = 0.5;\n// 回滚初始位置的速度\nvar speed = 200;\n// 纵向移动的峰值\nvar maxMoveY = 2;\n\n\nvar NodeTouchUtil = function(){}\n\nNodeTouchUtil.New = function(node) {\n    var inst = new NodeTouchUtil()\n    inst.img = node\n    var touchNode = new cc.Node()\n    touchNode.setContentSize(cc.director.getWinSize().width, 700)\n    touchNode.parent = inst.img\n    // inst.img = node.getChildByName('img')\n    inst.localPos = inst.img.getPosition()\n    inst.localRotate = inst.img.getRotation()\n    inst.initTouchFunction(touchNode)\n}\n\nNodeTouchUtil.prototype.initTouchFunction = function(node) {\n    node.on(cc.Node.EventType.TOUCH_START, (event)=>{\n        if ( this.hasChoose ) { return }\n        // this.img.setPosition(this.localPos)\n        // this.img.setRotation(this.localRotate)\n\n        var p = event.touch._point\n        this._lastTouchPoint = p\n        this._rotation = 0\n\n\n    })\n    \n    node.on(cc.Node.EventType.TOUCH_MOVE, (event)=>{\n        if ( this.hasChoose ) { return }\n        var p1 = this._lastTouchPoint\n        var p2 = event.touch._point\n        var dx = (p2.x - p1.x) * touchMoveScaleX\n        var dy = (p2.y - p1.y)\n        if ( dx != 0 ) { this._rotation = this._rotation + dx/Math.abs(dx)*0.4 }\n\n        if ( this.img.getPosition().y < -maxMoveY + this.localPos.y ) {\n            if ( dy < 0 ) { dy = 0}\n        } else if ( this.img.getPosition().y > maxMoveY + this.localPos.y ) {\n            if ( dy > 0 ) { dy = 0}\n        }\n\n        if ( dy > maxMoveY ) { dy = maxMoveY }\n        else if (dy < -maxMoveY ) { dy = -maxMoveY }\n        console.log(dx)\n\n        if ( Math.abs(dx > 10) ) {\n            this.img.setPosition(this.img.getPosition().x + dx, this.img.getPosition().y + dy)\n        } else {\n            this.img.runAction(cc.moveTo(0.2, cc.p(this.img.getPosition().x + dx, this.img.getPosition().y+dy)).easing(cc.easeSineIn()))\n        }\n\n        if  (Math.abs(dx) > 20 ) { \n            this.hasChoose = true \n            this.direction = dx > 0 ? 1 : -1\n            this.img.stopAllActions()\n            var posX = this.img.getPosition().x + this.direction * cc.director.getWinSize().width/2 + this.direction*this.img.getContentSize().width\n            this.img.runAction(cc.moveTo(0.3, cc.p(posX, this.img.getPosition().y)).easing(cc.easeSineIn()))\n        }\n        // this.img.runAction( cc.easeBounceOut(cc.sequence ) )\n        \n        this.img.setRotation(this._rotation)\n\n        // this.img.runAction(cc.moveBy(cc.p(dx/100, 0), 0.2))\n        // this.img.setPosition(this.img.getPosition().x + dx, this.img.getPosition().y)\n        // this.img.runAction( cc.moveBy(cc.p(dx,0), 0.1) ).easing(cc.easeInOut())\n        this._lastTouchPoint = cc.p(p2.x, p2.y)\n    })\n\n\n    var touchend = () => {\n        if ( this.hasChoose ) { \n            //调用已经选择的方法\n            return \n        }\n        this._lastTouchPoint = cc.p(0,0)\n        this.img.stopAllActions()\n        var dt = Math.abs(this._lastTouchPoint.x - this.localPos.x)/speed\n        dt = 0.3\n        this.img.runAction(cc.moveTo(dt, this.localPos).easing(cc.easeIn(3)))\n        this.img.runAction(cc.rotateTo(dt, 0, 0).easing(cc.easeIn(3)))\n    }\n\n    node.on(cc.Node.EventType.TOUCH_END, (event)=>{\n        touchend()\n    })\n\n    node.on(cc.Node.EventType.TOUCH_CANCEL, (event)=>{\n        touchend()\n    })\n\n\n\n}\n\n\n\n\nmodule.exports = NodeTouchUtil\n"]}